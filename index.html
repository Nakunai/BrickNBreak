<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <title>Brick'n Break</title>
        <style>
            * {
                padding: 0;
                margin: 0;
            }
            canvas {
                background: #9cf9ff;
                display: block;
                margin: 0 auto;
            }
        </style>
    </head>
    <body>
        <canvas id="gameCanvas" height="320" width="480"></canvas>
        <script>
            const canvas = document.getElementById("gameCanvas");
            const ctx = canvas.getContext("2d");

            const canvasWidth = canvas.width;
            const canvasHeight = canvas.height;

            const ballRadius = 10;
            const ballDirectionsX = [2, -2];

            const paddleWidth = 90;
            const paddleHeight = 12;
            const paddleMoveRatio = 6;

            const ballInitDirectionY = -2;

            let paddlePositionX = canvasWidth / 2 - paddleWidth / 2;
            let paddlePositionY = canvasHeight - paddleHeight;

            let ballPositionX = canvasWidth / 2;
            let ballPositionY = paddlePositionY - paddleHeight;
            let ballDirectionX = ballDirectionsX[Math.floor(Math.random() * 2)];
            let ballDirectionY = ballInitDirectionY;

            let arrowKeyLeftIsDown = false;
            let arrowKeyRightIsDown = false;

            function keyHandler(event) {
                let type = event.type;
                let key = event.key;

                if ('ArrowLeft' === key) {
                    arrowKeyLeftIsDown = type === 'keydown';
                }

                if ('ArrowRight' === key) {
                    arrowKeyRightIsDown = type === 'keydown';
                }
            }

            function drawBall() {
                ctx.beginPath();

                ctx.fillStyle = "red";
                ctx.arc(ballPositionX, ballPositionY, ballRadius, 0, Math.PI * 2);
                ctx.fill();

                ctx.closePath();
            }

            function drawPaddle() {
                ctx.beginPath();

                ctx.fillStyle = "black";
                ctx.rect(paddlePositionX, paddlePositionY, paddleWidth, paddleHeight)
                ctx.fill();

                ctx.closePath();
            }

            function ballHasCollision() {
                if (ballPositionX >= canvasWidth - ballRadius || ballPositionX <= ballRadius) {
                    ballDirectionX = -ballDirectionX;
                }


                if (ballPositionY <= ballRadius) {
                    ballDirectionY = -ballDirectionY;
                }

                if (ballPositionY >= canvasHeight - ballRadius) {
                    gameOver();
                }

                if (
                    ballPositionY - ballDirectionY >= paddlePositionY - paddleHeight
                    && ballPositionX - ballDirectionX >= paddlePositionX
                    && ballPositionX - ballDirectionX <= paddlePositionX + paddleWidth
                ) {
                    ballDirectionY = ballInitDirectionY;
                }
            }

            function paddleHasMove() {
                if (arrowKeyLeftIsDown) {
                    paddlePositionX -= paddleMoveRatio;
                }

                if (arrowKeyRightIsDown) {
                    paddlePositionX += paddleMoveRatio;
                }
            }

            function paddleHasCollision() {
                if (paddlePositionX <= 0) {
                    paddlePositionX = 0;
                }

                if (paddlePositionX + paddleWidth >= canvasWidth) {
                    paddlePositionX = canvasWidth - paddleWidth;
                }
            }

            function gameLoop() {
                ctx.clearRect(0, 0, canvasWidth, canvasHeight);

                drawBall();
                drawPaddle();

                paddleHasMove();
                paddleHasCollision();
                ballHasCollision();

                ballPositionX += ballDirectionX;
                ballPositionY += ballDirectionY;
            }

            function gameOver() {
                ctx.beginPath();

                ctx.font = "48px Impact";
                ctx.textAlign = 'center'
                ctx.fillStyle = "red";
                ctx.fillText("GAME OVER", canvasWidth / 2, canvasHeight / 2);

                ctx.closePath();

                clearInterval(gameLoopInterval);
            }

            let gameLoopInterval = setInterval(gameLoop, 10);

            document.addEventListener('keydown', keyHandler);
            document.addEventListener('keyup', keyHandler);
        </script>
    </body>
</html>