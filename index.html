<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <title>Brick'n Break</title>
        <style>
            * {
                padding: 0;
                margin: 0;
            }
            canvas {
                background-color: rgb(156,249,255);
                display: block;
                margin: 0 auto;
            }
        </style>
    </head>
    <body>
        <canvas id="gameCanvas"></canvas>
        <script>
            const canvas = document.getElementById("gameCanvas");

            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            const ctx = canvas.getContext("2d");

            const canvasWidth = canvas.width;
            const canvasHeight = canvas.height;

            const ballRadius = 15;
            const ballDirectionsX = [4, -4];

            const paddleWidth = 120;
            const paddleHeight = 12;
            const paddleMoveRatio = 10;

            const paddleInitPositionX = canvasWidth / 2 - paddleWidth / 2;
            const paddleInitPositionY = canvasHeight - paddleHeight;

            const ballInitPositionX = canvasWidth / 2;
            const ballInitPositionY = paddleInitPositionY - paddleHeight;
            const ballInitDirectionY = -4;

            const livesInit = 3;

            let paddlePositionX = paddleInitPositionX;
            let paddlePositionY = paddleInitPositionY;

            let ballPositionX = ballInitPositionX;
            let ballPositionY = ballInitPositionY;
            let ballDirectionX = ballDirectionsX[Math.floor(Math.random() * 2)];
            let ballDirectionY = ballInitDirectionY;

            let arrowKeyLeftIsDown = false;
            let arrowKeyRightIsDown = false;

            let lives = livesInit;

            function keyHandler(event) {
                let type = event.type;
                let key = event.key;

                if ('ArrowLeft' === key) {
                    arrowKeyLeftIsDown = type === 'keydown';
                }

                if ('ArrowRight' === key) {
                    arrowKeyRightIsDown = type === 'keydown';
                }
            }

            function resetPositions() {
                paddlePositionX = paddleInitPositionX;
                ballPositionX = ballInitPositionX;
                ballPositionY = ballInitPositionY;
                ballDirectionY = ballInitDirectionY;
                ballDirectionX = ballDirectionsX[Math.floor(Math.random() * 2)];
            }

            function drawLives() {
                ctx.beginPath();

                ctx.fillStyle = 'red';
                ctx.bezierCurveTo(37.5, 18.5, 37.5, 12.5, 25, 12.5);
                ctx.bezierCurveTo(10, 12.5, 10, 31, 10, 31);
                ctx.bezierCurveTo(10, 40, 20, 51, 37.5, 60);
                ctx.bezierCurveTo(55, 51, 65, 40, 65, 31);
                ctx.bezierCurveTo(65, 31, 65, 12.5, 50, 12.5);
                ctx.bezierCurveTo(42.5, 12.5, 37.5, 16.5, 37.5, 20);
                ctx.fill();

                ctx.font = "40px Impact";
                ctx.fillText('x ' + lives, 70, 55);

                ctx.closePath();
            }

            function drawBall() {
                ctx.beginPath();

                ctx.fillStyle = "red";
                ctx.arc(ballPositionX, ballPositionY, ballRadius, 0, Math.PI * 2);
                ctx.fill();

                ctx.closePath();
            }

            function drawPaddle() {
                ctx.beginPath();

                ctx.fillStyle = "black";
                ctx.rect(paddlePositionX, paddlePositionY, paddleWidth, paddleHeight)
                ctx.fill();

                ctx.closePath();
            }

            function ballHasCollision() {
                if (ballPositionY >= canvasHeight - ballRadius) {
                    lives--;

                    if (lives === 0) {
                        gameOver();
                    }

                    resetPositions();
                }

                if (ballPositionX >= canvasWidth - ballRadius || ballPositionX <= ballRadius) {
                    ballDirectionX = -ballDirectionX;
                }


                if (ballPositionY <= ballRadius) {
                    ballDirectionY = -ballDirectionY;
                }

                if (
                    ballPositionY - ballDirectionY >= paddlePositionY - paddleHeight
                    && ballPositionX - ballDirectionX >= paddlePositionX
                    && ballPositionX - ballDirectionX <= paddlePositionX + paddleWidth
                ) {
                    ballDirectionY = ballInitDirectionY;
                }
            }

            function paddleHasMove() {
                if (arrowKeyLeftIsDown) {
                    paddlePositionX -= paddleMoveRatio;
                }

                if (arrowKeyRightIsDown) {
                    paddlePositionX += paddleMoveRatio;
                }
            }

            function paddleHasCollision() {
                if (paddlePositionX <= 0) {
                    paddlePositionX = 0;
                }

                if (paddlePositionX + paddleWidth >= canvasWidth) {
                    paddlePositionX = canvasWidth - paddleWidth;
                }
            }

            function gameLoop() {
                ctx.fillStyle = "rgba(156,249,255,0.3)";
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                drawLives();
                drawPaddle();
                drawBall();

                paddleHasMove();
                paddleHasCollision();
                ballHasCollision();

                ballPositionX += ballDirectionX;
                ballPositionY += ballDirectionY;
            }

            function gameOver() {
                ctx.beginPath();

                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.font = "80px Impact";
                ctx.textAlign = 'center'
                ctx.fillStyle = "red";
                ctx.fillText("GAME OVER", canvasWidth / 2, canvasHeight / 2);

                ctx.closePath();

                clearInterval(gameLoopInterval);
            }

            let gameLoopInterval = setInterval(gameLoop, 10);

            document.addEventListener('keydown', keyHandler);
            document.addEventListener('keyup', keyHandler);
        </script>
    </body>
</html>