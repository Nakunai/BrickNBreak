<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <title>Brick'n Break</title>
        <style>
            * {
                padding: 0;
                margin: 0;
            }
            canvas {
                background-color: rgb(156,249,255);
                display: block;
                margin: 0 auto;
            }
        </style>
    </head>
    <body>
        <canvas id="gameCanvas"></canvas>
        <script>
            const canvas = document.getElementById("gameCanvas");

            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            const ctx = canvas.getContext("2d");

            const canvasWidth = canvas.width;
            const canvasHeight = canvas.height;

            const ballRadius = 15;
            const ballDirectionsX = [4, -4];

            const paddleWidth = 120;
            const paddleHeight = 12;
            const paddleMoveRatio = 12;

            const paddleInitPositionX = canvasWidth / 2 - paddleWidth / 2;
            const paddleInitPositionY = canvasHeight - paddleHeight;

            const ballInitPositionX = canvasWidth / 2;
            const ballInitPositionY = paddleInitPositionY - paddleHeight;
            const ballInitDirectionY = -4;

            const livesInit = 3;
            const scoreInit = 0;

            const brickColors = ["#007eea"]
            const numberBrickPerLine = 20;
            const numberBrickPerColumn = 4;
            const brickWidth = canvas.width / numberBrickPerLine;
            const brickHeight = brickWidth / 2;

            let paddlePositionX = paddleInitPositionX;
            let paddlePositionY = paddleInitPositionY;

            let ballPositionX = ballInitPositionX;
            let ballPositionY = ballInitPositionY;
            let ballDirectionX = ballDirectionsX[Math.floor(Math.random() * 2)];
            let ballDirectionY = ballInitDirectionY;

            let arrowKeyLeftIsDown = false;
            let arrowKeyRightIsDown = false;

            let lives = livesInit;
            let score = scoreInit;

            let brickMap = [];
            let isGameOver = false;


            for (let brickColumnPointer = 0; brickColumnPointer < numberBrickPerColumn; brickColumnPointer++) {
                brickMap[brickColumnPointer] = [];

                for (let brickLinePointer = 0; brickLinePointer < numberBrickPerLine; brickLinePointer++) {
                    let x = brickLinePointer * brickWidth;
                    let y = brickColumnPointer * brickHeight;

                    let color = brickColors[Math.floor(Math.random() * brickColors.length)];

                    brickMap[brickColumnPointer].push({'x': x, 'y': y, 'visible': true, 'color': color});
                }
            }

            console.log(brickMap);

            function keyEventHandler(event) {
                let type = event.type;
                let key = event.key;

                if ('ArrowLeft' === key) {
                    arrowKeyLeftIsDown = type === 'keydown';
                }

                if ('ArrowRight' === key) {
                    arrowKeyRightIsDown = type === 'keydown';
                }
            }

            function resetPositions() {
                paddlePositionX = paddleInitPositionX;
                ballPositionX = ballInitPositionX;
                ballPositionY = ballInitPositionY;
                ballDirectionY = ballInitDirectionY;
                ballDirectionX = ballDirectionsX[Math.floor(Math.random() * 2)];
            }

            function drawLives() {
                ctx.beginPath();

                ctx.fillStyle = 'red';
                ctx.strokeStyle = 'black';
                ctx.bezierCurveTo(37.5, 18.5, 37.5, 12.5, 25, 12.5);
                ctx.bezierCurveTo(10, 12.5, 10, 31, 10, 31);
                ctx.bezierCurveTo(10, 40, 20, 51, 37.5, 60);
                ctx.bezierCurveTo(55, 51, 65, 40, 65, 31);
                ctx.bezierCurveTo(65, 31, 65, 12.5, 50, 12.5);
                ctx.bezierCurveTo(42.5, 12.5, 37.5, 16.5, 37.5, 20);
                ctx.fill();
                ctx.stroke();

                ctx.font = "40px Impact";
                ctx.fillText('x ' + lives, 70, 55);
                ctx.strokeText('x ' + lives, 70, 55);

                ctx.closePath();
            }

            function drawScore() {
                ctx.beginPath();

                ctx.fillStyle = 'red';
                ctx.strokeStyle = 'black';

                ctx.font = "40px Impact";
                ctx.fillText('Score: ' + score, canvasWidth - 150, 55);
                ctx.strokeText('Score: ' + score, canvasWidth - 150, 55);

                ctx.closePath();
            }

            function drawBricks() {
                brickMap.forEach(function (column) {
                    column.forEach(function (brick) {
                        if (brick.visible) {
                            ctx.beginPath();
                            ctx.strokeStyle = 'black';
                            ctx.fillStyle = brick.color;
                            ctx.rect(brick.x, brick.y, brickWidth, brickHeight);
                            ctx.fill();
                            ctx.stroke();
                            ctx.closePath();
                        }
                    });
                });
            }

            function drawBall() {
                ctx.beginPath();

                ctx.fillStyle = "red";
                ctx.strokeStyle = 'black';
                ctx.arc(ballPositionX, ballPositionY, ballRadius, 0, Math.PI * 2);
                ctx.fill();
                ctx.stroke();

                ctx.closePath();
            }

            function drawPaddle() {
                ctx.beginPath();

                ctx.fillStyle = "#007eea";
                ctx.strokeStyle = 'black';
                ctx.rect(paddlePositionX, paddlePositionY, paddleWidth, paddleHeight)
                ctx.fill();
                ctx.stroke();

                ctx.closePath();
            }

            function ballHasCollision() {
                // Collision on down (Game Over or -1 live)
                if (ballPositionY >= canvasHeight) {
                    lives--;

                    if (lives === 0) {
                        gameOver();
                    }

                    resetPositions();
                }

                // Collision on walls (left | right)
                if (ballPositionX >= canvasWidth - ballRadius || ballPositionX <= ballRadius) {
                    ballDirectionX = -ballDirectionX;
                }

                // Collision on top wall
                if (ballPositionY <= ballRadius) {
                    ballDirectionY = -ballDirectionY;
                }

                // Collision on paddle
                if (
                    ballPositionY + ballRadius >= paddlePositionY
                    && ballPositionX - ballDirectionX >= paddlePositionX
                    && ballPositionX - ballDirectionX <= paddlePositionX + paddleWidth
                ) {
                    ballDirectionY = ballInitDirectionY;
                }

                // Collision on brick
                brickMap.forEach(function (column) {
                    column.forEach(function (brick) {
                        if (!brick.visible) {
                            return;
                        }

                        let brickCollision = false;

                        // Collision on brick (left-right)
                        if (ballPositionY < brick.y + brickHeight && ballPositionY > brick.y) {

                            // Collision on brick (left)
                            if (ballPositionX < brick.x && ballPositionX + ballRadius > brick.x) {
                                brickCollision = true;
                                ballDirectionX = -ballDirectionX;
                            }

                            // Collision on brick (right)
                            if (ballPositionX > brick.x && ballPositionX - ballRadius < brick.x + brickWidth) {
                                brickCollision = true;
                                ballDirectionX = -ballDirectionX;
                            }
                        }

                        // Collision on brick (top-bottom)
                        if (ballPositionX > brick.x && ballPositionX < brick.x + brickWidth) {

                            // Collision on brick (top)
                            if (
                                ballPositionY < brick.y
                                && ballPositionY + ballRadius < brick.y + brickHeight
                                && ballPositionY + ballRadius > brick.y
                            ) {
                                brickCollision = true;
                                ballDirectionY = -ballDirectionY;
                            }

                            // Collision on brick (bottom)
                            if (
                                ballPositionY > brick.y + brickHeight
                                && ballPositionY - ballRadius < brick.y + brickHeight
                                && ballPositionY - ballRadius > brick.y
                            ) {
                                brickCollision = true;
                                ballDirectionY = -ballDirectionY;
                            }
                        }

                        if (brickCollision) {
                            brick.visible = false;
                            score += 1;
                        }
                    });
                });
            }

            function paddleHasMove() {
                if (arrowKeyLeftIsDown) {
                    paddlePositionX -= paddleMoveRatio;
                }

                if (arrowKeyRightIsDown) {
                    paddlePositionX += paddleMoveRatio;
                }
            }

            function paddleHasCollision() {
                if (paddlePositionX <= 0) {
                    paddlePositionX = 0;
                }

                if (paddlePositionX + paddleWidth >= canvasWidth) {
                    paddlePositionX = canvasWidth - paddleWidth;
                }
            }

            function gameLoop() {
                ctx.fillStyle = "rgba(156,249,255,0.3)";
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                drawBricks();
                drawLives();
                drawScore();
                drawPaddle();
                drawBall();

                paddleHasMove();
                paddleHasCollision();
                ballHasCollision();

                ballPositionX += ballDirectionX;
                ballPositionY += ballDirectionY;

                if (!isGameOver) {
                    requestAnimationFrame(gameLoop);
                }
            }

            function gameOver() {
                ctx.beginPath();

                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.font = "80px Impact";
                ctx.textAlign = 'center'
                ctx.fillStyle = "red";
                ctx.strokeStyle = "black";

                ctx.fillText("GAME OVER", canvasWidth / 2, canvasHeight / 2);
                ctx.strokeText("GAME OVER", canvasWidth / 2, canvasHeight / 2);

                ctx.closePath();

                isGameOver = true;
            }

            gameLoop();

            document.addEventListener('keydown', keyEventHandler);
            document.addEventListener('keyup', keyEventHandler);
        </script>
    </body>
</html>